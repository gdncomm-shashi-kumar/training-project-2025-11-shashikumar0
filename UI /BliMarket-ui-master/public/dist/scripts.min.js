// BliMarket UI - Client Side JavaScript
(function() {
    'use strict';

    // Toast Notification System
    window.showToast = function(message, type = 'success') {
        // Remove any existing toasts first
        const existingToasts = document.querySelectorAll('.notification');
        existingToasts.forEach(t => t.remove());
        
        const toast = document.createElement('div');
        toast.className = `notification notification-${type}`;
        
        let icon = 'check-circle';
        if (type === 'error') {
            icon = 'exclamation-circle';
        } else if (type === 'info') {
            icon = 'info-circle';
        } else if (type === 'warning') {
            icon = 'exclamation-triangle';
        }
        
        toast.innerHTML = `
            <i class="fas fa-${icon}"></i>
            <span>${message}</span>
        `;
        document.body.appendChild(toast);
        
        // Auto-remove after 3 seconds
        setTimeout(() => {
            toast.style.animation = 'slideOut .3s forwards';
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, 300);
        }, 3000);
    };

    // Mobile menu toggle
    document.addEventListener('DOMContentLoaded', function() {
        const mobileToggle = document.getElementById('mobileMenuToggle');
        const mobileMenu = document.getElementById('mobileMenu');
        
        if (mobileToggle && mobileMenu) {
            mobileToggle.addEventListener('click', function() {
                mobileMenu.classList.toggle('active');
            });
        }

        // User dropdown toggle
        const userDropdown = document.getElementById('userDropdown');
        const userMenu = document.getElementById('userDropdownMenu');
        
        if (userDropdown && userMenu) {
            userDropdown.addEventListener('click', function(e) {
                e.stopPropagation();
                userMenu.classList.toggle('active');
            });
            
            document.addEventListener('click', function() {
                userMenu.classList.remove('active');
            });
        }

        // Update cart badge
        updateCartBadge();
    });

    // Update cart badge count
    function updateCartBadge() {
        const badge = document.getElementById('cartBadge');
        if (!badge) return;

        fetch('/cart-count', { credentials: 'include' })
            .then(res => res.json())
            .then(data => {
                if (data.count > 0) {
                    badge.textContent = data.count;
                    badge.style.display = 'flex';
                } else {
                    badge.style.display = 'none';
                }
            })
            .catch(() => {
                badge.style.display = 'none';
            });
    }

    window.updateCartBadge = updateCartBadge;

})();
